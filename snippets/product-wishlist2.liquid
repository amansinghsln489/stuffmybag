{% if customer %}
  {% assign value = product.id %}
  {% capture productID %}{{ product.id }}{% endcapture %}
  {% for tag in customer.tags %}
    {% capture tagID %}{{ tag }}{% endcapture %}
    {% if tagID contains productID %}
      {% capture value %}x{{ tagID }}{% endcapture %}
    {% endif %}
    {% if value.size == 0 %}
      {% assign value = productID %}
    {% endif %}
  {% endfor %}

  {% unless value.size == 0 %}
    {% assign check = tag.size | minus: productID.size | modulo: 2 %}
    {% comment %}{% capture check %}{{ value.size | minus:productID.size | money_without_currency | times:100 | divided_by:2 }}{% endcapture %}{% endcomment %}
    {% assign check = check | split: '.' %}
    {% if check[1] contains '5' %}
      {% assign display = false -%}
    {%- else -%}
      {%- assign display = true %}
    {% endif %}
  {% endunless %}

  {% if display %}
    <button
      class="wishlist-button"
      data-product-handle="{{ product.handle }}"
      onclick="toggleWishlist(this)"
    >
      ❤️ Add to Wishlist
    </button>

  {% else %}

  {% endif %}
{% else %}
  <button
    class="button btn-wishlist"
    type="button"
    data-toggle="tooltip"
    title="{{ 'products.product.add_to_wishlist' | t }}"
    data-original-title="{{ 'products.product.add_to_wishlist' | t }}"
    onclick="location.href='/account/login'"
  >
    <span>{{ 'products.product.add_to_wishlist' | t }}</span>
  </button>
{% endif %}

<script>

  function toggleWishlist(button) {
    let productHandle = button.getAttribute("data-product-handle");
    let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];

    if (wishlist.includes(productHandle)) {
      wishlist = wishlist.filter(handle => handle !== productHandle);
      button.innerHTML = "❤️ Add to Wishlist";
    } else {
      wishlist.push(productHandle);
      button.innerHTML = "✔ Added to Wishlist";
    }

    localStorage.setItem("wishlist", JSON.stringify(wishlist));
    updateWishlistCount();
  }
</script>
